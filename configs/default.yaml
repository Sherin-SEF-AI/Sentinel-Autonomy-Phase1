system:
  name: "SENTINEL"
  version: "1.0"
  log_level: "INFO"

cameras:
  # Frame synchronization tolerance (ms) - USB cameras typically need 50-100ms
  # Increased to 100ms to handle hardware timing variations (was seeing 60ms deviations)
  sync_tolerance_ms: 100.0

  interior:
    device: 0
    resolution: [640, 480]
    fps: 30
    calibration: "configs/calibration/interior.yaml"

  front_left:
    device: 1
    resolution: [1280, 720]
    fps: 30
    calibration: "configs/calibration/front_left.yaml"

  front_right:
    device: 2
    resolution: [1280, 720]
    fps: 30
    calibration: "configs/calibration/front_right.yaml"

bev:
  output_size: [640, 640]
  scale: 0.1  # meters per pixel
  vehicle_position: [320, 480]
  blending_method: "multiband"
  blend_width: 50

models:
  segmentation:
    architecture: "BEVFormer-Tiny"
    weights: "models/bev_segmentation.pth"
    device: "cuda"
    precision: "fp16"
    temporal_smoothing: true
    smoothing_alpha: 0.7
  
  detection:
    architecture: "YOLOv8"
    variant: "yolov8m"
    weights: "models/yolov8m_automotive.pt"
    confidence_threshold: 0.5
    nms_threshold: 0.4
  
  dms:
    face_detection: "MediaPipe"
    gaze_model: "L2CS-Net"
    gaze_weights: "models/l2cs_gaze.pth"
    drowsiness_weights: "models/drowsiness_model.pth"
    distraction_weights: "models/distraction_clf.pth"

fusion:
  method: "hungarian"
  iou_threshold_3d: 0.3
  confidence_weighting: true

tracking:
  algorithm: "DeepSORT"
  max_age: 30
  min_hits: 3
  iou_threshold: 0.3

risk_assessment:
  ttc_calculation:
    method: "constant_velocity"
    safety_margin: 1.5
  
  trajectory_prediction:
    # Basic trajectory prediction (used by simple predictor)
    horizon: 3.0
    dt: 0.1
    method: "linear"
    
    # Advanced trajectory prediction settings
    enabled: true
    use_lstm: false  # Enable when LSTM model is trained
    lstm_model: "models/trajectory_lstm.pth"
    num_hypotheses: 3
    uncertainty_estimation: true
    use_collision_probability: true
    collision_probability_weight: 0.4
    
    # Performance optimization
    target_time_per_object: 5.0  # ms
    enable_profiling: false
    enable_caching: true
    enable_parallel: true
  
  zone_mapping:
    num_zones: 8
  
  base_risk_weights:
    ttc: 0.4
    trajectory_conflict: 0.3
    vulnerability: 0.2
    relative_speed: 0.1
  
  thresholds:
    hazard_detection: 0.3
    intervention: 0.7
    critical: 0.9

alerts:
  suppression:
    duplicate_window: 5.0
    max_simultaneous: 2
  
  escalation:
    critical_threshold: 0.9
    high_threshold: 0.7
    medium_threshold: 0.5
  
  modalities:
    visual:
      display_duration: 3.0
      flash_rate: 2
    audio:
      volume: 0.8
      critical_sound: "sounds/alarm.wav"
      warning_sound: "sounds/beep.wav"
    haptic:
      enabled: false

recording:
  enabled: true
  triggers:
    risk_threshold: 0.7
    ttc_threshold: 1.5
  storage_path: "scenarios/"
  max_duration: 30.0

visualization:
  enabled: true
  port: 8080
  update_rate: 30

# HD Map Integration (Task 27)
hd_map:
  enabled: false  # Disabled by default - enable when map file is available
  map_file: "maps/city_map.xodr"  # Path to HD map file
  format: "opendrive"  # 'opendrive' or 'lanelet2'
  
  # Map matching configuration
  matching:
    gps_accuracy: 5.0  # GPS accuracy in meters for search radius
    match_threshold: 0.2  # Lateral offset threshold for valid match (meters)
    heading_weight: 0.4  # Weight for heading in match scoring (0-1)
    lateral_weight: 0.6  # Weight for lateral offset in match scoring (0-1)
  
  # Feature query configuration
  query:
    lookahead_distance: 100.0  # Default lookahead distance in meters
    search_radius: 50.0  # Default search radius for nearby features
    grid_cell_size: 50.0  # Spatial index grid cell size in meters
  
  # Caching configuration
  cache:
    enabled: true  # Enable query result caching
    ttl: 0.5  # Cache time-to-live in seconds
  
  # Path prediction configuration
  path_prediction:
    horizon: 5  # Number of lanes to predict ahead
    use_turn_signals: true  # Use turn signals for prediction
    use_destination: false  # Use destination for A* routing (if available)
  
  # Performance monitoring
  performance:
    max_query_time: 0.005  # Target max query time in seconds (5ms)
    log_slow_queries: true  # Log queries exceeding target time
  
  # GUI integration
  gui:
    show_map_overlay: false  # Show map overlay on BEV canvas by default
    show_map_dock: true  # Show map view dock widget
    highlight_current_lane: true  # Highlight current lane in map view

# CAN Bus Integration (Task 28)
can_bus:
  enabled: false  # Disabled by default - enable when CAN hardware is available
  interface: "socketcan"  # Interface type (socketcan for Linux)
  channel: "can0"  # CAN interface name (e.g., can0, vcan0)
  dbc_file: "configs/vehicle.dbc"  # DBC file path for message definitions
  enable_control: false  # Enable sending control commands (SAFETY: keep disabled unless in controlled test)
  log_traffic: true  # Log all CAN messages to file
  log_file: "logs/can_traffic.log"  # CAN log file path
  
  # Message IDs (override defaults if needed)
  message_ids:
    speed: 0x100  # 256
    steering: 0x200  # 512
    brake: 0x300  # 768
    throttle: 0x400  # 1024
    gear: 0x500  # 1280
    turn_signal: 0x600  # 1536
  
  # Command IDs
  command_ids:
    brake: 0x700  # 1792
    steering: 0x800  # 2048
  
  # Telemetry reader settings
  telemetry:
    update_rate: 100.0  # Hz
  
  # Command sender settings
  commands:
    max_brake: 1.0  # Maximum brake command (0-1)
    max_steering_angle: 0.5  # Maximum steering angle in radians (~28 degrees)
    watchdog_timeout: 0.5  # Watchdog timeout in seconds

# =============================================================================
# Cloud Synchronization Configuration
# =============================================================================
cloud:
  # Enable/disable cloud synchronization
  enabled: false
  
  # API connection settings
  api_url: "https://api.sentinel-fleet.com"
  api_key: ""  # Set your API key here
  vehicle_id: "vehicle_001"
  fleet_id: "fleet_alpha"
  
  # Connection settings
  timeout: 30.0  # Request timeout in seconds
  max_retries: 3  # Maximum retry attempts
  rate_limit: 10.0  # Maximum requests per second
  
  # Sync intervals
  trip_upload_interval: 300  # Upload trips every 5 minutes
  model_check_interval: 86400  # Check for model updates every 24 hours
  connectivity_check_interval: 30  # Check connectivity every 30 seconds
  
  # Upload settings
  auto_install_models: true  # Automatically install model updates
  compression_quality: 23  # Video compression quality (18-28, lower = better)
  
  # Data sharing consent
  upload_trips: false  # Upload trip summaries (anonymized)
  upload_scenarios: false  # Upload high-risk scenarios
  sync_profiles: false  # Sync driver profiles across vehicles
  
  # Storage paths
  trip_queue_file: "data/trip_queue.json"
  scenarios_dir: "scenarios"
  profiles_dir: "profiles"
  models_dir: "models"

# =============================================================================
# Advanced Features Configuration
# =============================================================================
features:
  # Lane detection and departure warning
  lane_detection:
    enabled: true
    detector:
      canny_low: 50
      canny_high: 150
      hough_threshold: 30
      min_line_length: 40
      max_line_gap: 100
      use_smoothing: true
      smoothing_alpha: 0.8
    departure_warning:
      lateral_offset_threshold: 0.3  # meters
      time_to_crossing_threshold: 2.0  # seconds
      min_speed_for_warning: 8.0  # m/s (~30 km/h)
      pixels_per_meter: 30.0

  # Blind spot monitoring
  blind_spot:
    enabled: true
    left_zone_y_min: 0.5  # meters (left side)
    left_zone_y_max: 2.5
    right_zone_y_min: -2.5  # meters (right side)
    right_zone_y_max: -0.5
    zone_x_min: -3.0  # Behind vehicle
    zone_x_max: 1.0  # Slightly ahead
    min_object_confidence: 0.5
    warning_hysteresis_frames: 5

  # Forward collision warning
  collision_warning:
    enabled: true
    caution_ttc: 3.5  # Time-to-collision thresholds (seconds)
    warning_ttc: 2.5
    critical_ttc: 1.5
    emergency_braking_ttc: 0.8
    zone_width: 3.0  # meters
    zone_length_max: 100.0  # meters
    min_confidence: 0.5
    min_speed_for_warning: 5.0  # m/s

  # Traffic sign recognition
  traffic_signs:
    enabled: true
    confidence_threshold: 0.6
    nms_threshold: 0.4

  # Road surface analysis
  road_analysis:
    enabled: true
    wet_threshold: 0.3
    puddle_min_area: 100  # pixels

  # Parking assistance
  parking:
    enabled: false  # Enable manually when needed
    min_width: 2.0  # meters
    min_length: 4.5  # meters
    vehicle_width: 1.8  # meters
    vehicle_length: 4.5  # meters
    parking_clearance: 0.3  # meters
    pixels_per_meter: 30.0

  # Trip analytics
  trip_analytics:
    enabled: true
    save_dir: "data/trips"
    hard_brake_threshold: 4.0  # m/s²
    rapid_accel_threshold: 3.0  # m/s²

  # Driver behavior scoring
  driver_scoring:
    enabled: true
    attention_weight: 0.4
    smoothness_weight: 0.2
    safety_weight: 0.3
    hazard_response_weight: 0.1
    event_window: 60.0  # seconds

  # Multi-object interaction prediction
  interaction_prediction:
    enabled: true
    pedestrian_crossing_threshold: 1.5  # meters from center
    lane_change_lateral_threshold: 0.3  # m/s lateral velocity
    merge_angle_threshold: 20  # degrees
    cyclist_turn_angle_threshold: 15  # degrees
    overtake_speed_threshold: 5.0  # m/s relative speed
    collision_prediction_horizon: 5.0  # seconds
    min_confidence: 0.3

  # GPS tracking and speed limit monitoring
  gps:
    enabled: false  # Enable when GPS hardware is available
    device: "/dev/ttyUSB0"  # GPS device path
    baudrate: 9600  # GPS serial baudrate
    simulation: true  # Use simulation mode for testing
    cache_file: "data/speed_limits_cache.json"  # Speed limit cache
